name: Add Tag

run-name: Add Tag:${{ github.ref_name }}(${{ github.event.head_commit.message }})

on:
 push:
   branches:
     - main

jobs:
  add-tag:
    runs-on: ubuntu-latest

    container:
      image: ros:humble-ros-base

    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - id: tag_name
        run: echo name=$(xmllint --xpath /package/version package.xml | sed 's/^.*<version.*>\(.*\)<\/version>.*$/v\1/') >> $GITHUB_OUTPUT

      - name: Add safe directory
        run: git config --global --add safe.directory /__w/traps_tools_ros/traps_tools_ros
      
      - name: Add tag
        run: git tag ${{ steps.tag_name.outputs.name }}
      
      - name: Push
        run: git push origin ${{ steps.tag_name.outputs.name }}